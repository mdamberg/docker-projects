version: 2

models:
  - name: fct_power_consumption
    description: "Fact table for power consumption readings at 5-minute intervals"
    meta:
      metrics:
        total_kwh:
          type: sum
          sql: ${device_state} / 12000
          description: "Total energy consumption in kilowatt-hours"
        avg_watts:
          type: average
          sql: ${device_state}
          description: "Average power draw in watts"
        max_watts:
          type: max
          sql: ${device_state}
          description: "Maximum power draw in watts"
        min_watts:
          type: min
          sql: ${device_state}
          description: "Minimum power draw in watts"
        reading_count:
          type: count
          sql: ${power_consumption_record_id}
          description: "Number of readings"
    columns:
      - name: recorded_date
        description: "Date of the power reading"
        meta:
          dimension:
            type: date
      - name: recorded_at_time
        description: "Time of the power reading"
        meta:
          dimension:
            type: string
        config:
          meta:
            dimension:
              type: timestamp
      - name: power_consumption_record_id
        description: "Unique identifier for each reading"
        meta:
          dimension:
            type: string
      - name: power_consumption_entity_id
        description: "Identifier for the power entity"
        meta:
          dimension:
            type: string
      - name: entity_name
        description: "Sensor entity name"
        meta:
          dimension:
            type: string
      - name: power_entity
        description: "Friendly name of the power entity"
        meta:
          dimension:
            type: string
      - name: device_state
        description: "Instantaneous power draw in watts"
        meta:
          dimension:
            type: number
      - name: unit_of_measurement
        description: "Unit of measurement (Watts)"
        meta:
          dimension:
            type: string
      - name: inserted_date
        description: "Date the record was inserted"
        meta:
          dimension:
            type: date
      - name: inserted_at_time
        description: "Time the record was inserted"
        meta:
          dimension:
            type: string
        config:
          meta:
            dimension:
              type: timestamp
